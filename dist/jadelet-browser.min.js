!function(n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jadelet=n()}(function(){return function r(i,u,o){function a(e,n){if(!u[e]){if(!i[e]){var t="function"==typeof require&&require;if(!n&&t)return t(e,!0);if(c)return c(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}t=u[e]={exports:{}},i[e][0].call(t.exports,function(n){return a(i[e][1][n]||n)},t,t.exports,r,i,u,o)}return u[e].exports}for(var c="function"==typeof require&&require,n=0;n<o.length;n++)a(o[n]);return a}({1:[function(n,A,e){var t;(t=function(t,a){var o=Array(16),c=0,s=/\S+|[^\S]+|$/y,f=0,u=function(n,e){n<f||(f<n&&(f=n,c=0),o[c++]=e)},l=function(n){var e=n instanceof RegExp?(e=n.toString()).slice(0,e.lastIndexOf("/")+1):"string"==typeof n?""===n?"EOF":JSON.stringify(n):n;return(n=r.get(n))?`${n} ${e}`:e},r=new Map,p=function(n,e){return n&&r.set(e,n),e},d=null,h=function(n,e,t,r){var i,u,o;if(Array.isArray(n))return[u,i,o]=n,o=[b[u],function(){switch(u){case"/":case"S":return i.map(function(n){return h(n,null,t,r)});case"*":case"+":case"?":case"!":case"&":return h(i,null,t+u,r);case"R":return p(t,RegExp(i,"uy"));case"L":return p(t,JSON.parse('"'+i+'"'));default:throw new Error(`Don't know how to pre-compute ${JSON.stringify(u)}`)}}(),r(o,u,t)],e?(e[0]=o[0],e[1]=o[1],e[2]=o[2],e):o;if(d[n])return d[n];if(d[n]=o=e||[],null==(e=a[n]))throw new Error(`No rule with name ${JSON.stringify(n)}`);return h(e,o,n,r)},i=function(n){return n.value},n=function(e,n){var t;return null!=e&&e.f?(t=Function("$loc","$0","$1","$2","$3","$4","$5","$6","$7","$8","$9",e.f),"S"===n?function(n){return t.apply(null,[n.loc,n.value].concat(n.value))}:"R"===n?function(n){return t.apply(null,[n.loc].concat(n.value))}:function(n){return t(n.loc,n.value,n.value)}):"R"===n?null!=e?function(n){return g(e,n.value)}:function(n){return n.value[0]}:"S"===n?null!=e?function(n){return g(e,[n.value].concat(n.value))}:function(n){return n.value}:function(n){return g(e,n.value)}},v=function(n,e){return d={},n=Object.keys(n)[0],d[n]=h(n,null,n,e),d},y=function(n,e){var t,r;return[t,r,e]=e,r=t(n,r),null==e&&(e=i),r&&(r.value=e(r)),r},g=function(n,e){switch(typeof n){case"number":return e[n];case"string":return n;case"object":if(Array.isArray(n))return n.map(function(n){return g(n,e)});throw new Error("non-array object mapping");case"undefined":return e;default:throw new Error("Unknown mapping type")}},b={L:function(n,e){var t,r;return{input:t,pos:r}=n,n=e["length"],t.substr(r,n)===e?{loc:{pos:r,length:n},pos:r+n,value:e}:u(r,e)},R:function(n,e){var t,r,i;return{input:t,pos:r}=n,e.lastIndex=n.pos,null!=(i=(t=t.match(e))?t[0]:i)?{loc:{pos:r,length:i=i.length},pos:r+i,value:t}:u(r,e)},S:function(n,e){var t,r,i,u,o,a;for({input:r,pos:u}=n,o=[],n=u,t=0,i=e.length;;){if(!(a=y({input:r,pos:u},e[t++])))return;if({pos:u,value:a}=a,o.push(a),i<=t)break}return{loc:{pos:n,length:u-n},pos:u,value:o}},"/":function(n,e){for(var t,r=0,i=e.length;;){if(t=y(n,e[r++]))return t;if(i<=r)break}},"?":function(n,e){return y(n,e)||n},"*":function(n,e){var t,r,i,u,o;for({input:t,pos:r}=n,n=r,u=[];;){if(null==(o=y({input:t,pos:i=r},e)))break;if({pos:r,value:o}=o,r===i)break;u.push(o)}return{loc:{pos:n,length:r-n},pos:r,value:u}},"+":function(n,e){var t,r,i;if({input:r,pos:i}=n,null!=(t=y(n,e)))return n=t["pos"],n=(e=y({input:r,pos:n},[b["*"],e]))["pos"],e.value.unshift(t.value),{loc:{pos:i,length:n-i},value:e.value,pos:n}},"!":function(n,e){e=y(n,e);if(null==e)return n},"&":function(n,e){e=y(n,e);if(e.pos!==n.pos)return n}},S=function(n,r){var e;return[e,n]=n.split(/\n|\r\n|\r/).reduce(function([n,e],t){t=t.length+1;return t<r?(r-=t,[n+1,1]):(0<=r&&(e+=r,r=-1),[n,e])},[1,1]),`${e}:${n}`},E=function(n,e,{filename:t}){var r,i,u;if(null!=e&&e.pos===n.length)return e.value;throw r=Array.from(new Set(o.slice(0,c))),u=S(n,f),null!=e&&e.pos>f?(u=S(n,e.pos),new Error(`Unconsumed input at ${u}

${n.slice(e.pos)}
`)):r.length?(s.lastIndex=f,[i]=n.match(s),i=i.length?l(i):"EOF",new Error(`${t}:${u} Failed to parse
Expected:
\t${r.map(l).join("\n\t")}
Found: ${i}`)):new Error(`Unconsumed input at ${u}

${n.slice(e.pos)}
`)},e=function(n,e={}){var t;if("string"!=typeof n)throw new Error("Input must be a string");return null==e.filename&&(e.filename="[stdin]"),t={input:n,pos:f=c=0},e.tokenize&&v(a,O),t=y(t,Object.values(d)[0]),E(n,t,e)},O=function(n,e,t){return function({value:n}){if(null==n)return n;switch(e){case"S":return{type:t,value:n.filter(function(n){return null!=n}).reduce(function(n,e){return n.concat(e)},[])};case"L":case"R":return{type:t,value:n};case"*":case"+":return{type:e,value:n};case"?":case"/":return n;case"!":case"&":return{type:e+t,value:n}}}},$=function(n,e){n=`(function(create, rules) {
  create(create, rules);
}(${t.toString()}, ${JSON.stringify(n)}));
`;return e?(e={},Function("module",n)(e),e.exports):n},m=function(n){return null==n?"":" -> "+function(){switch(typeof n){case"number":return n;case"string":return JSON.stringify(n);case"object":return Array.isArray(n)?JSON.stringify(n):`\n${n.f.replace(/^|\n/g,"$&    ")}`}}()},w=function(n,e=0){var t,r,i;if(!Array.isArray(n))return n;switch(t=n[0],r=n[2],t){case"*":case"+":case"?":return w(n[1],e+1)+t+m(r);case"&":case"!":return t+w(n[1],e+1);case"L":return'"'+n[1]+'"'+m(r);case"R":return"/"+n[1]+"/"+m(r);case"S":return i=n[1].map(function(n){return w(n,e+1)}),e<1?i.join(" ")+m(r):"( "+i.join(" ")+" )";case"/":return i=n[1].map(function(n){return w(n,e&&e+1)}),0!==e||r?"( "+i.join(" / ")+" )"+m(r):i.join("\n  ")}},L=function(e){return Object.keys(e).map(function(n){return`${n}\n  ${w(e[n])}\n`}).join("\n")};return v(a,n),A.exports={decompile:L,parse:e,generate:$,rules:a}})(t,{Template:["S",[["?","__"],["*","Line"]],{f:'var top = a => a[a.length-1];\nfunction reduceLines(lines) {\n  var depth = 0;\n  var stack = [[]];\n  var firstIndent = 0;\n  lines.forEach( ([indent, line]) => {\n    if (firstIndent === 0 && indent > depth + 1) {\n      firstIndent = indent;\n      indent = 1;\n    }\n    indent = indent > firstIndent ? indent - firstIndent : indent;\n    if (Array.isArray(line)) {\n      line[1] = collectAttributes(line[1])\n    }\n    if (depth+1 === indent) {\n      // We\'re adding to the content of the last element in the current stack\n      stack.push(top(top(stack))[2])\n    } else if ( indent > depth) {\n      throw new Error("Indented too far")\n    } else if (indent < depth) {\n      stack = stack.slice(0, indent + 1)\n    }\n    depth = indent\n    top(stack).push(line)\n  })\n  return stack[0]\n}\nfunction collectAttributes(attributesArray) {\n  return attributesArray.reduce((o, [key, value]) => {\n    if (key === "id" || key === "class" || key === "style") {\n      var p = o[key] || (o[key] = [])\n      p.push(value)\n    } else {\n      o[key] = value\n    }\n    return o\n  }, {})\n}\nfunction pretty(lines) {\n  return lines.map(line =>\n    JSON.stringify(line)\n  )\n}\nvar reduced = reduceLines($2);\nif (reduced.length != 1) {\n  throw new Error("Must have exactly one root node.");\n}\nreturn reduced[0];'}],Line:["S",["Indent","LineBody","EOS"],[1,2]],LineBody:["/",[["S",["Tag",["?","DeprecatedEquals"],"_","RestOfLine"],{f:"$1[2].push($4)\nreturn $1"}],["S",["Tag",["?","_"]],1],["S",[["L","|"],["?",["L"," "]],"RestOfLine"],{f:'return $3 + "\\n";'}],["S",[["?",["S",["DeprecatedEquals","_"]]],"RestOfLine"],2]]],RestOfLine:["R","[^\\n\\r]*",{f:'// TODO: Handle runs of text with bound content inside\nif ($0.slice(0,1) === "@") {\n  return {\n    bind: $0.slice(1)\n  }\n} else {\n  return $0\n}'}],DeprecatedEquals:["L","=",{f:"console.warn(\"'= <content>' is deprecated, you can remove the '=' without issue.\")"}],Tag:["/",[["S",["TagName","OptionalIds","OptionalClasses","OptionalAttributes"],{f:"return [\n  $1,\n  $2.concat($3, $4),\n  [],\n]"}],["S",["Ids","OptionalClasses","OptionalAttributes"],{f:'return [\n  "div",\n  $1.concat($2, $3),\n  [],\n]'}],["S",["Classes","OptionalAttributes"],{f:'return [\n  "div",\n  $1.concat($2),\n  [],\n]'}]]],OptionalClasses:["/",["Classes",["L","",{f:"return []"}]]],Classes:["+","Class"],Class:["/",[["S",[["L","."],"Identifier"],{f:'return ["class", $2]'}],["S",[["L","."],["!","Identifier"]],{f:'throw "Expected a class name"'}],"IdError"]],OptionalIds:["?","Ids",{f:"return $1 || []"}],Ids:["S",["Id"],{f:"return [ $1 ]"}],Id:["/",[["S",[["L","#"],"Identifier"],{f:'return ["id", $2]'}],["S",[["L","#"],["!","Identifier"]],{f:'throw "Expected an id name"'}]]],IdError:["L","#",{f:'throw "Ids must appear before classes and attributes. Elements can only have one id."'}],ClassError:["L",".",{f:'throw "Classes cannot appear after attributes."'}],TagName:["/",[["S",["Identifier"],1],["S",[["L"," "],"Identifier"],2]]],OptionalAttributes:["/",[["S",[["L","("],["?","__"],["+","Attribute"],["L",")"],["?","IdError"],["?","ClassError"]],{f:"return $3"}],["L","(",{f:'throw "Invalid attributes"'}],["L","",{f:"return []"}]]],Attribute:["/",[["S",["AtIdentifier",["?","__"]],{f:"return [$1.bind, $1]"}],["S",["EqBinding",["?","__"]],1],["S",["Identifier",["?","__"]],{f:'return [$1, ""]'}]]],AtIdentifier:["S",[["L","@"],"Identifier"],{f:"return {\n  bind: $2\n}"}],EqBinding:["S",["Identifier",["L","="],["/",["AtIdentifier","Value"]]],[1,3]],Identifier:["R","[a-zA-Z][a-zA-Z0-9-]*"],Indent:["*",["/",[["L","  "],["L","\\t"]]],{f:"return $1.length"}],_:["R","[ \\t]+"],__:["+",["/",[["R","[ \\t]"],"EOL"]]],Value:["/",[["S",[["L",'\\"'],["*","DoubleStringCharacter"],["L",'\\"']],{f:'return $2.join("")'}],["S",[["L","'"],["*","SingleStringCharacter"],["L","'"]],{f:'return $2.join("")'}],"Number"]],DoubleStringCharacter:["/",[["S",[["!",["/",[["L",'\\"'],["L","\\\\"]]]],["R","."]],2],["S",[["L","\\\\"],"EscapeSequence"],2]]],SingleStringCharacter:["/",[["S",[["!",["/",[["L","'"],["L","\\\\"]]]],["R","."]],2],["S",[["L","\\\\"],"EscapeSequence"],2]]],EscapeSequence:["/",[["L","'"],["L",'\\"'],["L","\\\\"],["R",".",{f:'return "\\\\" + $0'}]]],Number:["/",[["R","-?[0-9]+\\.[0-9]+"],["R","-?[0-9]+"]]],EOS:["/",[["S",[["+",["S",[["?","_"],"EOL"]]],"_","EOF"]],["+",["S",[["?","_"],"EOL"]]],"EOF"]],EOL:["/",[["L","\\r\\n"],["L","\\n"],["L","\\r"]]],EOF:["!",["R","[\\s\\S]"]]})},{}],2:[function(n,e,t){"use strict";var r,o=n("o_0"),i=Array.prototype.forEach,u=new WeakMap,a=new WeakMap,c=function(n){var e=a.get(n)||0;a.set(n,e+1)},p=function(n){var e=a.get(n)||0;0<--e?a.set(n,e):(a.delete(n),s(n))},s=function(e){var n=e.children;null!=n&&i.call(n,s),null!=(n=u.get(e))&&n.forEach(function(n){n(),u.delete(e)})},f=function(n,e){var t;if("function"!=typeof e)throw new Error("whoops");(t=u.get(n))?t.push(e):u.set(n,[e])},l=/^on(touch|animation|transition)(start|iteration|move|end|cancel)$/,d=function(n,e){return n.match(l)||n in e},h=function(t,n,e,r){var i;switch(e){case"id":b(t,n,r,function(n){var e=n.length;e?t.id=n[e-1]:t.removeAttribute("id")});break;case"class":b(t,n,r,function(n){n=n.join(" ");n?t.className=n:t.removeAttribute("class")});break;case"style":b(t,n,r,function(n){t.removeAttribute("style"),n.forEach(function(n){return O(n)?Object.assign(t.style,n):t.setAttribute("style",n)})});break;case"value":y(t,r,n);break;case"checked":r&&O(r)&&(i=r["bind"],t.onchange=function(){"function"==typeof n[i]&&n[i](t.checked)}),v(t,r,n,function(n){t.checked=n});break;default:d(`on${e}`,t)?g(t,e,r.bind,n):v(t,r,n,function(n){null!=n&&!1!==n?t.setAttribute(e,n):t.removeAttribute(e)})}},v=function(n,e,t,r){var i,u;if($(e))return r(e);0!==(u="function"==typeof e?o(function(){r(e.call(t))}):(i=e["bind"],o(function(){r(w(t[i],t))})))._observableDependencies.size&&f(n,u.releaseDependencies)},y=function(e,n,t){var r;n&&"object"==typeof n&&(r=n["bind"],e.oninput=e.onchange=function(){"function"==typeof t[r]&&t[r](e.value)}),v(e,n,t,function(n){e.value!==n&&(e.value=n)})},g=function(n,e,t,r){t=r[t];"function"==typeof t&&n.addEventListener(e,t.bind(r))},b=function(n,e,t,r){v(n,function(){return m(t,e)},e,r)},S=function(f,e,n,t){var l=[],r=0;n.forEach(function(n,a){var c,s;if(l[a]=r,Array.isArray(n))f.appendChild(L(n,e,t)),r++;else if($(n))f.appendChild(document.createTextNode(n)),r++;else{if(!O(n))throw new Error("oof");c=0,v(f,n,e,function(n){var e,t,r,i,u,o;for(s=c,u=l[a],e=f.childNodes[u+c],o=new Array(c),i=0;i<c;)t=f.childNodes[u],f.removeChild(t),o[i]=t,i++;for(c=E(f,n,e),i=0;i<s;)t=o[i],p(t),i++;for(r=c-s,i=a+1;i<l.length;)l[i]+=r,i++}),r+=c}})},E=function(e,n,t){var r;return null==n?0:Array.isArray(n)?n.map(function(n){return E(e,n,t)}).reduce(function(n,e){return n+e},0):(n instanceof Node?(c(n),e.insertBefore(n,t)):(r=n.element)instanceof Node?(c(r),e.insertBefore(r,t)):e.insertBefore(document.createTextNode(n),t),1)},O=function(n){return"object"==typeof n},$=function(n){return"string"==typeof n},m=function(n,e){return n.map(function(n){return $(n)?n:w(e[n.bind],e)}).reduce(function(n,e){return n.concat(e)},[]).filter(function(n){return null!=n})},w=function(n,e){return"function"==typeof n?n.call(e):n},L=function(n,e={},t){var r,i,u;return[u,r,n]=n,i=(t="svg"===u&&!t?"http://www.w3.org/2000/svg":t)?document.createElementNS(t,u):document.createElement(u),S(i,e,n,t),Object.keys(r).forEach(function(n){h(i,e,n,r[n])}),i},n=n("./jadelet-parser");e.exports=r={compile:function(n,e={}){var t=r.parse(n),n=e.runtime||"require('jadelet')";return`${e.exports||"module.exports"} = ${n}.exec(${JSON.stringify(t)});`},parse:n.parse,parser:n,exec:function(e){return"function"==typeof e?e:("string"==typeof e&&(e=r.parse(e)),function(n){return L(e,n)})},Observable:o,_elementCleaners:u,dispose:s,retain:c,release:p}},{"./jadelet-parser":1,o_0:3}],3:[function(n,e,t){!function(r){!function(){!function(){"use strict";var c,n,s,t,f,l,p,d,h=[].slice;e.exports=function(t,e){var r,i,u,o,a;return"function"==typeof(null!=t?t.observe:void 0)?t:(u=[],o=function(e){return n(u).forEach(function(n){return n(e)})},"function"==typeof t?(i=t,(a=function(){return f(a),t}).releaseDependencies=function(){var n;return null!=(n=a._observableDependencies)?n.forEach(function(n){return n.stopObserving(r)}):void 0},(r=function(){var n=new Set;return t=d(n,i,e),a.releaseDependencies(),(a._observableDependencies=n).forEach(function(n){return n.observe(r)}),o(t)})()):(a=function(n){return 0<arguments.length?t!==n&&o(t=n):f(a),t}).releaseDependencies=l,Array.isArray(t)&&(["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some"].forEach(function(e){return a[e]=function(){var n=1<=arguments.length?h.call(arguments,0):[];return f(a),t[e].apply(t,n)}}),["pop","push","reverse","shift","splice","sort","unshift"].forEach(function(e){return a[e]=function(){var n=1<=arguments.length?h.call(arguments,0):[],n=t[e].apply(t,n);return o(t),n}}),c&&Object.defineProperty(a,"length",{get:function(){return f(a),t.length},set:function(n){n=t.length=n;return o(t),n}}),s(a,{remove:function(n){var n=t.indexOf(n);if(0<=n)return n=t.splice(n,1)[0],o(t),n},get:function(n){return f(a),t[n]},first:function(){return f(a),t[0]},last:function(){return f(a),t[t.length-1]},size:function(){return f(a),t.length}})),s(a,{listeners:u,observe:function(n){return u.push(n)},stopObserving:function(n){return p(u,n)},toggle:function(){return a(!t)},increment:function(n){return a(t+(n=null==n?1:n))},decrement:function(n){return a(t-(n=null==n?1:n))},toString:function(){return"Observable("+t+")"}}),a)},s=Object.assign,r.OBSERVABLE_ROOT_HACK=[],f=function(n){var e=t(r.OBSERVABLE_ROOT_HACK);if(e)return e.add(n)},d=function(n,e,t){r.OBSERVABLE_ROOT_HACK.push(n);try{return e.call(t)}finally{r.OBSERVABLE_ROOT_HACK.pop()}},p=function(n,e){e=n.indexOf(e);if(0<=e)return n.splice(e,1)[0]},n=function(n){return n.concat([])},t=function(n){return n[n.length-1]},l=function(){};try{Object.defineProperty(function(){},"length",{get:l,set:l}),c=!0}catch(n){c=!1}}.call(this)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[2])(2)});
