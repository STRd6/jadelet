!function(n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jadelet=n()}(function(){return function r(u,i,o){function a(e,n){if(!i[e]){if(!u[e]){var t="function"==typeof require&&require;if(!n&&t)return t(e,!0);if(c)return c(e,!0);throw(n=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",n}t=i[e]={exports:{}},u[e][0].call(t.exports,function(n){return a(u[e][1][n]||n)},t,t.exports,r,u,i,o)}return i[e].exports}for(var c="function"==typeof require&&require,n=0;n<o.length;n++)a(o[n]);return a}({1:[function(n,$,e){var t;(t=function(t,a){var o=Array(16),c=0,s=/\S+|[^\S]+|$/y,f=0,i=function(n,e){n<f||(f<n&&(f=n,c=0),o[c++]=e)},l=function(n){var e=n instanceof RegExp?(e=n.toString()).slice(0,e.lastIndexOf("/")+1):"string"==typeof n?""===n?"EOF":JSON.stringify(n):n;return(n=r.get(n))?n+" "+e:e},r=new Map,p=function(n,e){return n&&r.set(e,n),e},d=null,h=function(n,e,t,r){var u,i,o;if(Array.isArray(n))return[i,u,o]=n,o=[b[i],function(){switch(i){case"/":case"S":return u.map(function(n){return h(n,null,t,r)});case"*":case"+":case"?":case"!":case"&":return h(u,null,t+i,r);case"R":return p(t,RegExp(u,"uy"));case"L":return p(t,JSON.parse('"'+u+'"'));default:throw new Error("Don't know how to pre-compute "+JSON.stringify(i))}}(),r(o,i,t)],e?(e[0]=o[0],e[1]=o[1],e[2]=o[2],e):o;if(d[n])return d[n];if(d[n]=o=e||[],null==(e=a[n]))throw new Error("No rule with name "+JSON.stringify(n));return h(e,o,n,r)},u=function(n){return n.value},v=function(n,e){return d={},n=Object.keys(n)[0],d[n]=h(n,null,n,e),d},y=function(n,e){var t,r;return[e,t,r]=e,e=e(n,t),null==r&&(r=u),e&&(e.value=r(e)),e},g=function(n,e){switch(typeof n){case"number":return e[n];case"string":return n;case"object":if(Array.isArray(n))return n.map(function(n){return g(n,e)});throw new Error("non-array object mapping");case"undefined":return e;default:throw new Error("Unknown mapping type")}},b={L:function(n,e){var t,r;return{input:n,pos:r}=n,t=e["length"],n.substr(r,t)===e?{loc:{pos:r,length:t},pos:r+t,value:e}:i(r,e)},R:function(n,e){var t,r,u;return{input:t,pos:r}=n,e.lastIndex=n.pos,null!=(u=(n=t.match(e))?n[0]:u)?{loc:{pos:r,length:t=u.length},pos:r+t,value:n}:i(r,e)},S:function(n,e){var t,r,u,i,o,a;for({input:r,pos:i}=n,o=[],n=i,t=0,u=e.length;;){if(!(a=y({input:r,pos:i},e[t++])))return;if({pos:i,value:a}=a,o.push(a),u<=t)break}return{loc:{pos:n,length:i-n},pos:i,value:o}},"/":function(n,e){for(var t,r=0,u=e.length;;){if(t=y(n,e[r++]))return t;if(u<=r)break}},"?":function(n,e){return y(n,e)||n},"*":function(n,e){var t,r,u,i,o;for({input:t,pos:r}=n,n=r,i=[];;){if(null==(o=y({input:t,pos:u=r},e)))break;if({pos:r,value:o}=o,r===u)break;i.push(o)}return{loc:{pos:n,length:r-n},pos:r,value:i}},"+":function(n,e){var t,r,u;if({input:r,pos:u}=n,null!=(n=y(n,e)))return t=n["pos"],t=(r=y({input:r,pos:t},[b["*"],e]))["pos"],r.value.unshift(n.value),{loc:{pos:u,length:t-u},value:r.value,pos:t}},"!":function(n,e){e=y(n,e);if(null==e)return n},"&":function(n,e){e=y(n,e);if(e.pos!==n.pos)return n}},S=function(n,r){var e;return[n,e]=n.split(/\n|\r\n|\r/).reduce(function([n,e],t){t=t.length+1;return t<r?(r-=t,[n+1,1]):(0<=r&&(e+=r,r=-1),[n,e])},[1,1]),n+":"+e},O=function(n,e,{filename:t}){var r,u,i;if(null!=e&&e.pos===n.length)return e.value;throw r=Array.from(new Set(o.slice(0,c))),i=S(n,f),null!=e&&e.pos>f?(i=S(n,e.pos),new Error(`Unconsumed input at ${i}

${n.slice(e.pos)}
`)):r.length?(s.lastIndex=f,[u]=n.match(s),u=u.length?l(u):"EOF",new Error(`${t}:${i} Failed to parse
Expected:
	${r.map(l).join("\n\t")}
Found: `+u)):new Error(`Unconsumed input at ${i}

${n.slice(e.pos)}
`)},n=function(n,e={}){var t;if("string"!=typeof n)throw new Error("Input must be a string");return null==e.filename&&(e.filename="[stdin]"),t={input:n,pos:f=c=0},e.tokenize&&v(a,m),t=y(t,Object.values(d)[0]),O(n,t,e)},m=function(n,e,t){return function({value:n}){if(null==n)return n;switch(e){case"S":return{type:t,value:n.filter(function(n){return null!=n}).reduce(function(n,e){return n.concat(e)},[])};case"L":case"R":return{type:t,value:n};case"*":case"+":return{type:e,value:n};case"?":case"/":return n;case"!":case"&":return{type:e+t,value:n}}}},e=function(n,e){n=`(function(create, rules) {
  create(create, rules);
}(${t.toString()}, ${JSON.stringify(n)}));
`;return e?(e={},Function("module",n)(e),e.exports):n},E=function(n){return null==n?"":" -> "+function(){switch(typeof n){case"number":return n;case"string":return JSON.stringify(n);case"object":return Array.isArray(n)?JSON.stringify(n):`
`+n.f.replace(/^|\n/g,"$&    ")}}()},w=function(n,e=0){var t,r,u;if(!Array.isArray(n))return n;switch(t=n[0],r=n[2],t){case"*":case"+":case"?":return w(n[1],e+1)+t+E(r);case"&":case"!":return t+w(n[1],e+1);case"L":return'"'+n[1]+'"'+E(r);case"R":return"/"+n[1]+"/"+E(r);case"S":return u=n[1].map(function(n){return w(n,e+1)}),e<1?u.join(" ")+E(r):"( "+u.join(" ")+" )";case"/":return u=n[1].map(function(n){return w(n,e&&e+1)}),0!==e||r?"( "+u.join(" / ")+" )"+E(r):u.join("\n  ")}},L=function(e){return Object.keys(e).map(function(n){return n+`
  ${w(e[n])}
`}).join("\n")};return v(a,function(e,n){var t;return null!=e&&e.f?(t=Function("$loc","$0","$1","$2","$3","$4","$5","$6","$7","$8","$9",e.f),"S"===n?function(n){return t.apply(null,[n.loc,n.value].concat(n.value))}:"R"===n?function(n){return t.apply(null,[n.loc].concat(n.value))}:function(n){return t(n.loc,n.value,n.value)}):"R"===n?null!=e?function(n){return g(e,n.value)}:function(n){return n.value[0]}:"S"===n?null!=e?function(n){return g(e,[n.value].concat(n.value))}:function(n){return n.value}:function(n){return g(e,n.value)}}),$.exports={decompile:L,parse:n,generate:e,rules:a}})(t,{Template:["S",[["?","__"],["*","Line"]],{f:'var top = a => a[a.length-1];\nfunction reduceLines(lines) {\n  var depth = 0;\n  var stack = [[]];\n  var firstIndent = 0;\n  lines.forEach( ([indent, line]) => {\n    if (firstIndent === 0 && indent > depth + 1) {\n      firstIndent = indent - 1;\n    }\n    indent = indent > firstIndent ? indent - firstIndent : indent;\n    if (Array.isArray(line)) {\n      line[1] = collectAttributes(line[1])\n    }\n    if (depth+1 === indent) {\n      // We\'re adding to the content of the last element in the current stack\n      stack.push(top(top(stack))[2])\n    } else if ( indent > depth) {\n      throw new Error("Indented too far")\n    } else if (indent < depth) {\n      stack = stack.slice(0, indent + 1)\n    }\n    depth = indent\n    top(stack).push(line)\n  })\n  return stack[0]\n}\nfunction collectAttributes(attributesArray) {\n  return attributesArray.reduce((o, [key, value]) => {\n    if (key === "id" || key === "class" || key === "style") {\n      var p = o[key] || (o[key] = [])\n      p.push(value)\n    } else {\n      o[key] = value\n    }\n    return o\n  }, {})\n}\nfunction pretty(lines) {\n  return lines.map(line =>\n    JSON.stringify(line)\n  )\n}\nvar reduced = reduceLines($2);\nif (reduced.length != 1) {\n  throw new Error("Must have exactly one root node.");\n}\nreturn reduced[0];'}],Line:["S",["Indent","LineBody","EOS"],[1,2]],LineBody:["/",[["S",["Tag",["?","DeprecatedEquals"],"_","RestOfLine"],{f:"$1[2].push($4)\nreturn $1"}],["S",["Tag",["?","_"]],1],["S",[["L","|"],["?",["L"," "]],"RestOfLine"],{f:'return $3 + "\\n";'}],["S",[["?",["S",["DeprecatedEquals","_"]]],"RestOfLine"],2]]],RestOfLine:["R","[^\\n\\r]*",{f:'// TODO: Handle runs of text with bound content inside\nif ($0.slice(0,1) === "@") {\n  return {\n    bind: $0.slice(1)\n  }\n} else {\n  return $0\n}'}],DeprecatedEquals:["L","=",{f:"console.warn(\"'= <content>' is deprecated, you can remove the '=' without issue.\")"}],Tag:["/",[["S",["TagName","OptionalIds","OptionalClasses","OptionalAttributes"],{f:"return [\n  $1,\n  $2.concat($3, $4),\n  [],\n]"}],["S",["Ids","OptionalClasses","OptionalAttributes"],{f:'return [\n  "div",\n  $1.concat($2, $3),\n  [],\n]'}],["S",["Classes","OptionalAttributes"],{f:'return [\n  "div",\n  $1.concat($2),\n  [],\n]'}]]],OptionalClasses:["/",["Classes",["L","",{f:"return []"}]]],Classes:["+","Class"],Class:["/",[["S",[["L","."],"Identifier"],{f:'return ["class", $2]'}],["S",[["L","."],["!","Identifier"]],{f:'throw "Expected a class name"'}],"IdError"]],OptionalIds:["?","Ids",{f:"return $1 || []"}],Ids:["S",["Id"],{f:"return [ $1 ]"}],Id:["/",[["S",[["L","#"],"Identifier"],{f:'return ["id", $2]'}],["S",[["L","#"],["!","Identifier"]],{f:'throw "Expected an id name"'}]]],IdError:["L","#",{f:'throw "Ids must appear before classes and attributes. Elements can only have one id."'}],ClassError:["L",".",{f:'throw "Classes cannot appear after attributes."'}],TagName:"Identifier",OptionalAttributes:["/",[["S",[["L","("],["?","__"],["+","Attribute"],["L",")"],["?","IdError"],["?","ClassError"]],{f:"return $3"}],["L","(",{f:'throw "Invalid attributes"'}],["L","",{f:"return []"}]]],Attribute:["/",[["S",["AtIdentifier",["?","__"]],{f:"return [$1.bind, $1]"}],["S",["EqBinding",["?","__"]],1],["S",["Identifier",["?","__"]],{f:'return [$1, ""]'}]]],AtIdentifier:["S",[["L","@"],"Identifier"],{f:"return {\n  bind: $2\n}"}],EqBinding:["S",["Identifier",["L","="],["/",["AtIdentifier","Value"]]],[1,3]],Identifier:["R","[a-zA-Z][a-zA-Z0-9-]*"],Indent:["*",["/",[["L","  "],["L","\\t"]]],{f:"return $1.length"}],_:["R","[ \\t]+"],__:["+",["/",[["R","[ \\t]"],"EOL"]]],Value:["/",[["S",[["L",'\\"'],["*","DoubleStringCharacter"],["L",'\\"']],{f:'return $2.join("")'}],["S",[["L","'"],["*","SingleStringCharacter"],["L","'"]],{f:'return $2.join("")'}],"Number"]],DoubleStringCharacter:["/",[["S",[["!",["/",[["L",'\\"'],["L","\\\\"]]]],["R","."]],2],["S",[["L","\\\\"],"EscapeSequence"],2]]],SingleStringCharacter:["/",[["S",[["!",["/",[["L","'"],["L","\\\\"]]]],["R","."]],2],["S",[["L","\\\\"],"EscapeSequence"],2]]],EscapeSequence:["/",[["L","'"],["L",'\\"'],["L","\\\\"],["R",".",{f:'return "\\\\" + $0'}]]],Number:["/",[["R","-?[0-9]+\\.[0-9]+"],["R","-?[0-9]+"]]],EOS:["/",[["S",[["+",["S",[["?","_"],"EOL"]]],"_","EOF"]],["+",["S",[["?","_"],"EOL"]]],"EOF"]],EOL:["/",[["L","\\r\\n"],["L","\\n"],["L","\\r"]]],EOF:["!",["R","[\\s\\S]"]]})},{}],2:[function(n,e,t){"use strict";var r,o=n("o_0"),u=Array.prototype.forEach,i=new WeakMap,a=new WeakMap,c=function(n){var e=a.get(n)||0;a.set(n,e+1)},p=function(n){var e=a.get(n)||0;0<--e?a.set(n,e):(a.delete(n),s(n))},s=function(e){var n=e.children;null!=n&&u.call(n,s),null!=(n=i.get(e))&&n.forEach(function(n){n(),i.delete(e)})},f=function(n,e){var t=i.get(n);t?t.push(e):i.set(n,[e])},l=/^on(touch|animation|transition)(start|iteration|move|end|cancel)$/,d=function(n,e){return n.match(l)||n in e},h=function(t,n,e,r){var u;switch(e){case"id":b(t,n,r,function(n){var e=n.length;e?t.id=n[e-1]:t.removeAttribute("id")});break;case"class":b(t,n,r,function(n){n=n.join(" ");n?t.className=n:t.removeAttribute("class")});break;case"style":b(t,n,r,function(n){t.removeAttribute("style"),n.forEach(function(n){return m(n)?Object.assign(t.style,n):t.setAttribute("style",n)})});break;case"value":y(t,r,n);break;case"checked":r&&m(r)&&(u=r["bind"],t.onchange=function(){"function"==typeof n[u]&&n[u](t.checked)}),v(t,r,n,function(n){t.checked=!1!==n});break;default:d("on"+e,t)?g(t,e,r.bind,n):v(t,r,n,function(n){null!=n&&!1!==n?t.setAttribute(e,n):t.removeAttribute(e)})}},v=function(n,e,t,r){var u,i;if(E(e))return r(e);0!==(i="function"==typeof e?o(function(){r(e.call(t))}):(u=e["bind"],o(function(){r(L(t[u],t))})))._observableDependencies.size&&f(n,i.releaseDependencies)},y=function(e,n,t){var r;n&&"object"==typeof n&&(r=n["bind"],e.oninput=e.onchange=function(){"function"==typeof t[r]&&t[r](e.value)}),v(e,n,t,function(n){e.value!==n&&(e.value=n)})},g=function(n,e,t,r){t=r[t];"function"==typeof t&&n.addEventListener(e,t.bind(r))},b=function(n,e,t,r){v(n,function(){return w(t,e)},e,r)},S=function(f,e,n,t){var l=[],r=0;n.forEach(function(n,a){var c,s;if(l[a]=r,Array.isArray(n))f.appendChild($(n,e,t)),r++;else if(E(n))f.appendChild(document.createTextNode(n)),r++;else{if(!m(n))throw new Error("oof");c=0,v(f,n,e,function(n){var e,t,r,u,i,o;for(s=c,i=l[a],e=f.childNodes[i+c],o=new Array(c),u=0;u<c;)t=f.childNodes[i],f.removeChild(t),o[u]=t,u++;for(c=O(f,n,e),u=0;u<s;)t=o[u],p(t),u++;for(r=c-s,u=a+1;u<l.length;)l[u]+=r,u++}),r+=c}})},O=function(e,n,t){var r;return null==n?0:Array.isArray(n)?n.map(function(n){return O(e,n,t)}).reduce(function(n,e){return n+e},0):(n instanceof Node?(c(n),e.insertBefore(n,t)):(r=n.element)instanceof Node?(c(r),e.insertBefore(r,t)):e.insertBefore(document.createTextNode(n),t),1)},m=function(n){return"object"==typeof n},E=function(n){return"string"==typeof n},w=function(n,e){return n.map(function(n){return E(n)?n:L(e[n.bind],e)}).reduce(function(n,e){return n.concat(e)},[]).filter(function(n){return null!=n})},L=function(n,e){return"function"==typeof n?n.call(e):n},$=function(n,e={},t){var r,u,i;return[n,r,u]=n,i=(t="svg"!==n||t?t:"http://www.w3.org/2000/svg")?document.createElementNS(t,n):document.createElement(n),S(i,e,u,t),Object.keys(r).forEach(function(n){h(i,e,n,r[n])}),i},n=n("./jadelet-parser");e.exports=r={compile:function(n,e={}){var n=r.parse(n),t=e.runtime||"require('jadelet')";return`${e.exports||"module.exports"} = ${t}.exec(${JSON.stringify(n)});`},parse:n.parse,parser:n,exec:function(e){return"string"==typeof e&&(e=r.parse(e)),function(n){return $(e,n)}},Observable:o,_elementCleaners:i,dispose:s,retain:c,release:p}},{"./jadelet-parser":1,o_0:3}],3:[function(n,e,t){!function(r){!function(){!function(){"use strict";var c,n,s,t,f,l,p,d,h=[].slice;e.exports=function(t,e){var r,u,i,o,a;return"function"==typeof(null!=t?t.observe:void 0)?t:(i=[],o=function(e){return n(i).forEach(function(n){return n(e)})},"function"==typeof t?(u=t,(a=function(){return f(a),t}).releaseDependencies=function(){var n;return null!=(n=a._observableDependencies)?n.forEach(function(n){return n.stopObserving(r)}):void 0},(r=function(){var n=new Set;return t=d(n,u,e),a.releaseDependencies(),(a._observableDependencies=n).forEach(function(n){return n.observe(r)}),o(t)})()):(a=function(n){return 0<arguments.length?t!==n&&o(t=n):f(a),t}).releaseDependencies=l,Array.isArray(t)&&(["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some"].forEach(function(e){return a[e]=function(){var n=1<=arguments.length?h.call(arguments,0):[];return f(a),t[e].apply(t,n)}}),["pop","push","reverse","shift","splice","sort","unshift"].forEach(function(e){return a[e]=function(){var n=1<=arguments.length?h.call(arguments,0):[],n=t[e].apply(t,n);return o(t),n}}),c&&Object.defineProperty(a,"length",{get:function(){return f(a),t.length},set:function(n){n=t.length=n;return o(t),n}}),s(a,{remove:function(n){var n=t.indexOf(n);if(0<=n)return n=t.splice(n,1)[0],o(t),n},get:function(n){return f(a),t[n]},first:function(){return f(a),t[0]},last:function(){return f(a),t[t.length-1]},size:function(){return f(a),t.length}})),s(a,{listeners:i,observe:function(n){return i.push(n)},stopObserving:function(n){return p(i,n)},toggle:function(){return a(!t)},increment:function(n){return a(t+(n=null==n?1:n))},decrement:function(n){return a(t-(n=null==n?1:n))},toString:function(){return"Observable("+t+")"}}),a)},s=Object.assign,r.OBSERVABLE_ROOT_HACK=[],f=function(n){var e=t(r.OBSERVABLE_ROOT_HACK);if(e)return e.add(n)},d=function(n,e,t){r.OBSERVABLE_ROOT_HACK.push(n);try{return e.call(t)}finally{r.OBSERVABLE_ROOT_HACK.pop()}},p=function(n,e){e=n.indexOf(e);if(0<=e)return n.splice(e,1)[0]},n=function(n){return n.concat([])},t=function(n){return n[n.length-1]},l=function(){};try{Object.defineProperty(function(){},"length",{get:l,set:l}),c=!0}catch(n){c=!1}}.call(this)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[2])(2)});
